<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the censusxy Package • censusxy</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the censusxy Package">
<meta property="og:description" content="censusxy">
<meta property="og:image" content="https://slu-openGIS.github.io/censusxy/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">censusxy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/censusxy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/slu-openGIS/censusxy/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the censusxy Package</h1>
                        <h4 class="author">Branson Fox and Christopher Prener, Ph.D.</h4>
            
            <h4 class="date">2020-05-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slu-openGIS/censusxy/blob/master/vignettes/censusxy.Rmd"><code>vignettes/censusxy.Rmd</code></a></small>
      <div class="hidden name"><code>censusxy.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The <code>censusxy</code> package is designed to provide easy access to the <a href="https://geocoding.geo.census.gov/geocoder/">U.S. Census Bureau Geocoding Tools</a> in <code>R</code>.</p>
<div id="motivation" class="section level3">
<h3 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h3>
<p>There do not exist many packages for free or reproducible geocoding in the R environment. However, the Census Bureau Geocoding Tools allow for both unlimited free geocoding as well as an added level of reproducibility compared to commercial geocoders. Many geospatial workflows involve a large quantity of addresses, hence our core focus is on batch geocoding.</p>
</div>
<div id="responsible-use" class="section level3">
<h3 class="hasAnchor">
<a href="#responsible-use" class="anchor"></a>Responsible Use</h3>
<p>The U.S. Census Bureau makes their geocoding API available without any API key, and this package allows for virtually unlimited batch geocoding. Please use this package responsibly, as others will need use of this API for their research.</p>
</div>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h3>
<p>The easiest way to get <code>censusxy</code> is to install it from CRAN:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"censusxy"</span>)</pre></body></html></div>
<p>The development version of <code>censusxy</code> can be accessed from GitHub with <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># install.packages("remotes")</span>
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"slu-openGIS/censusxy"</span>)</pre></body></html></div>
</div>
</div>
<div id="workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h2>
<div id="importing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#importing-data" class="anchor"></a>Importing Data</h3>
<p>If you plan on using the single address geocoding tools, your data do not need to be in any specific class. To use the batch geocoder, your data must be in a data.frame (or equivalent class). This package provides Homicides in St Louis City between 2008-2018 as example data.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"stl_homicides"</span>)</pre></body></html></div>
</div>
<div id="parsing-addresses" class="section level3">
<h3 class="hasAnchor">
<a href="#parsing-addresses" class="anchor"></a>Parsing Addresses</h3>
<p>For use of the batch API, your address data needs to be structured. Meaning, your data contains seperate columns for street address, city, state and zipcode. You may find the <a href="https://github.com/slu-openGIS/postmastr"><code>postmastr</code></a> package useful for this task. Only street address is mandatory, but omission of city, state or zip code drastically lowers the speed and accuracy of the batch geocoder.</p>
</div>
<div id="pick-a-suitable-api" class="section level3">
<h3 class="hasAnchor">
<a href="#pick-a-suitable-api" class="anchor"></a>Pick A Suitable API</h3>
<p>The Census Geocoder contains 4 primary functions, 3 for single address geocoding, and 1 for batch geocoding. For interactive use cases, a Shiny application for example, the single line geocoder is recommended. For large quantities of addresses, the batch endpoint is favorable.</p>
<p>If your usecase is locating coordinates within census geometries, only a single coordinate function is available for this task.</p>
</div>
<div id="pick-a-return-type" class="section level3">
<h3 class="hasAnchor">
<a href="#pick-a-return-type" class="anchor"></a>Pick a Return Type</h3>
<p>If you are interested in census geometries (composed of FIPS codes for state, county, tract and block), you should specify ‘geographies’ in the <code>return</code> argument. This also necessitates the use of a vintage.</p>
</div>
<div id="consider-the-benchmark-and-vintage" class="section level3">
<h3 class="hasAnchor">
<a href="#consider-the-benchmark-and-vintage" class="anchor"></a>Consider the Benchmark and Vintage</h3>
<p>Vintage is only important to consider when geocoding census geographies. It has no impact on geocoding coordinates (location). You can obtain a data.frame of valid benchmarks and vintages with their respective functions. For vintages, you must supply the name or ID of the benchmark you have chosen.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/cxy_benchmarks.html">cxy_benchmarks</a></span>()
<span class="fu"><a href="../reference/cxy_vintages.html">cxy_vintages</a></span>(<span class="kw">benchmark</span> <span class="kw">=</span> <span class="st">'Public_AR_Census2010'</span>)</pre></body></html></div>
</div>
<div id="parallelization-unix-only" class="section level3">
<h3 class="hasAnchor">
<a href="#parallelization-unix-only" class="anchor"></a>Parallelization (UNIX ONLY)</h3>
<p>If you are on a UNIX platform (macOS, Linux, etc.), you may take advantage of multiple threads to greatly increase performance. This functionality is not currently supported on Windows Operating Systems, however. All you have to do is specify the number of cores you would like to use and the function will automatically distribute the workload in the most efficient manner. The function will not allow you to specify more cores than are available, and will instead default to the maximum number of available cores.</p>
</div>
<div id="class-and-output" class="section level3">
<h3 class="hasAnchor">
<a href="#class-and-output" class="anchor"></a>Class and Output</h3>
<p>When using the batch function, you may specify <code>class</code> to “sf” which will return the results as an sf object, allowing for quick preview or export of the spatial data. However, doing this will only return addresses for which the geocoder could successfully match. A helpful message denoting how many rows were removed will print in the console.</p>
<p>You may also specify <code>output</code> as “simple” or “full”. Simple returns only coordinates (and a GEOID if <code>return = "geographies"</code>) and this is suitable for most use cases. If you desire all of the raw output from the geocoder, please specify full instead.</p>
</div>
<div id="timeout" class="section level3">
<h3 class="hasAnchor">
<a href="#timeout" class="anchor"></a>Timeout</h3>
<p>The function contains an argument for timeout, which specifies how many minutes until the API query ends as an error. In this implementation, it is per 1000 addresses, not the whole batch size. It is set to default at 30 minutes, which should be appropriate for most internet speeds.</p>
<p>If a batch times out, the function will terminate, and you will lose any geocoding progress.</p>
<p>Be cautious that batches taking a long time may allow your computer to sleep, which may cause a batch to never return. macOS users may find the app <a href="http://lightheadsw.com/caffeine/">caffeine</a> useful (Also available as a Command Line Tool).</p>
</div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div id="geographies" class="section level3">
<h3 class="hasAnchor">
<a href="#geographies" class="anchor"></a>Geographies</h3>
<p>If you would like to append census geographies, or have control of the benchmark in order to reproduce geocoding results, you will find it convenient to use the built in functions for doing so. If you are not concerned about reproducibility or geographies, the functions will default to the latest benchmark, and you may ignore this section.</p>
<p>Get the current valid benchmarks, these are used to geocode and show available vintages.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/cxy_benchmarks.html">cxy_benchmarks</a></span>()</pre></body></html></div>
<p>Once, you’ve selected a benchmark, and only if you intend to append geographies, you should choose a vintage based on the benchmark you selected (Either by name or ID).</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/cxy_vintages.html">cxy_vintages</a></span>(<span class="st">'Public_AR_Census2010'</span>)
<span class="fu"><a href="../reference/cxy_vintages.html">cxy_vintages</a></span>(<span class="fl">9</span>) <span class="co"># Same as Above</span></pre></body></html></div>
<p>Both of these should be supplied as arguments to your geocoding function.</p>
</div>
<div id="batch-geocoding" class="section level3">
<h3 class="hasAnchor">
<a href="#batch-geocoding" class="anchor"></a>Batch Geocoding</h3>
<p>In this example, we will use the included <code>stl_homicides</code> data to show the full process for batch geocoding.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">homicide_sf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cxy_geocode.html">cxy_geocode</a></span>(<span class="no">stl_homicides</span>, <span class="kw">address</span> <span class="kw">=</span> <span class="no">street_address</span>, <span class="kw">city</span> <span class="kw">=</span> <span class="no">city</span>, <span class="kw">state</span> <span class="kw">=</span> <span class="no">state</span>, <span class="kw">zip</span> <span class="kw">=</span> <span class="no">postal_code</span>, <span class="kw">class</span> <span class="kw">=</span> <span class="st">"sf"</span>)</pre></body></html></div>
<p>Note, however, that it returns only matched addresses, including those approximated by street length. If there are unmatched addresses, they will be dropped from the output. Use <code>class = "dataframe"</code> to return all addresses, including those that are unmatched.</p>
<p>Output returned as an <code>sf</code> object can be previewed with a package like <a href="https://cran.r-project.org/package=mapview"><code>mapview</code></a>:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r">&gt; mapview::mapview(homicide_sf)</pre></body></html></div>
<p><img src="../man/figures/homicide_example.png" width="100%"></p>
</div>
<div id="single-address-tools" class="section level3">
<h3 class="hasAnchor">
<a href="#single-address-tools" class="anchor"></a>Single Address Tools</h3>
<p>We’ll investigate a few other use cases, specifically those involving fewer or single addresses.</p>
<p>You would like to geocode a single structured address:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/cxy_single.html">cxy_single</a></span>(<span class="st">'20 N Grand Blvd'</span>, <span class="st">'St. Louis'</span>, <span class="st">'MO'</span>, <span class="fl">63103</span>)</pre></body></html></div>
<p>You would like to geocode a single unstructured address and append census geographies:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/cxy_oneline.html">cxy_oneline</a></span>(<span class="st">"3700 Lindell Blvd, St. Louis, MO 63108"</span>, <span class="kw">return</span> <span class="kw">=</span> <span class="st">'geographies'</span>, <span class="kw">vintage</span> <span class="kw">=</span> <span class="st">'Current_Current'</span>)</pre></body></html></div>
<p>You would like to append census geographies to a given coordinate:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/cxy_geography.html">cxy_geography</a></span>(-<span class="fl">90.23324</span>, <span class="fl">38.63593</span>)</pre></body></html></div>
<div id="iteration" class="section level4">
<h4 class="hasAnchor">
<a href="#iteration" class="anchor"></a>Iteration</h4>
<p>For a handful of addresses, you may want to iterate using these functions. Two examples using base R are provided here.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">addresses</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"20 N Grand Blvd, St. Louis MO 63103"</span>, <span class="st">"3700 Lindell Blvd, St. Louis, MO 63108"</span>)

<span class="co"># With A For Loop</span>
<span class="no">geocodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span>(<span class="st">"list"</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">addresses</span>)){
  <span class="no">geocodes</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cxy_oneline.html">cxy_oneline</a></span>(<span class="no">addresses</span>[<span class="no">i</span>])
}

<span class="co"># With an Apply Function</span>
<span class="no">geocodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">addresses</span>, <span class="no">cxy_oneline</span>)</pre></body></html></div>
</div>
</div>
</div>
<div id="getting-help" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help" class="anchor"></a>Getting Help</h2>
<ul>
<li>If you are new to <code>R</code> itself, welcome! Hadley Wickham’s <a href="http://r4ds.had.co.nz"><em>R for Data Science</em></a> is an excellent way to get started with data manipulation in the tidyverse, which <code>censusxy</code> is designed to integrate seamlessly with.</li>
<li>If you are new to spatial analysis in <code>R</code>, we strongly encourage you check out the excellent new <a href="https://geocompr.robinlovelace.net"><em>Geocomputation in R</em></a> by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow.</li>
<li>If you have questions about using <code>censusxy</code>, you are encouraged to use the <a href="https://community.rstudio.com">RStudio Community forums</a>. Please create a <a href="http://reprex.tidyverse.org/"><code>reprex</code></a> before posting. Feel free to tag Chris (<code>@chris.prener</code>) in any posts about <code>censusxy</code>.</li>
<li>If you think you’ve found a bug, please create a <a href="http://reprex.tidyverse.org/"><code>reprex</code></a> and then open an issue on <a href="https://github.com/slu-openGIS/censusxy/issues/new/choose">GitHub</a>.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://chris-prener.github.io">Christopher Prener</a>, <a href="https://bransonf.com">Branson Fox</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
